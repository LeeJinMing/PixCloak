name: IndexNow Auto Submit

# åœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨æäº¤åˆ° IndexNowï¼š
# 1. æ¯æ¬¡æ¨é€åˆ° main åˆ†æ”¯
# 2. æ¯å¤©å®šæ—¶è¿è¡Œä¸€æ¬¡ï¼ˆç¡®ä¿æ–°å†…å®¹è¢«ç´¢å¼•ï¼‰
# 3. å¯æ‰‹åŠ¨è§¦å‘

on:
  push:
    branches: [main]
    paths:
      - "app/**/*.tsx"
      - "app/**/*.ts"
      - "app/**/page.tsx"
      - "lib/**"
  schedule:
    # æ¯å¤© UTC æ—¶é—´ 2:00ï¼ˆåŒ—äº¬æ—¶é—´ 10:00ï¼‰è¿è¡Œ
    - cron: "0 2 * * *"
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  submit-indexnow:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout ä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"
          cache-dependency-path: web/package-lock.json

      - name: å®‰è£…ä¾èµ–
        working-directory: ./web
        run: npm ci

      - name: æäº¤æ‰€æœ‰ URLs åˆ° IndexNow
        working-directory: ./web
        env:
          NEXT_PUBLIC_SITE_URL: ${{ secrets.NEXT_PUBLIC_SITE_URL || 'https://pixcloak.com' }}
          INDEXNOW_KEY: ${{ secrets.INDEXNOW_KEY }}
          BATCH_SIZE: 100
          DELAY_MS: 2000
        run: |
          echo "å¼€å§‹æäº¤ URLs åˆ° IndexNow..."
          node ./scripts/submit-indexnow-all.mjs
          echo "âœ… IndexNow æäº¤å®Œæˆ"

      - name: é€šçŸ¥ Bing Webmaster Tools
        working-directory: ./web
        env:
          NEXT_PUBLIC_SITE_URL: ${{ secrets.NEXT_PUBLIC_SITE_URL || 'https://pixcloak.com' }}
        run: |
          echo "é€šçŸ¥ Bing ç½‘ç«™åœ°å›¾æ›´æ–°..."
          curl -f "https://www.bing.com/ping?sitemap=${NEXT_PUBLIC_SITE_URL}/sitemap.xml" || true
          curl -f "https://www.bing.com/ping?sitemap=${NEXT_PUBLIC_SITE_URL}/guides/sitemap.xml" || true
          echo "âœ… Bing é€šçŸ¥å®Œæˆ"

      - name: è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
        run: |
          echo "ğŸ‰ IndexNow è‡ªåŠ¨æäº¤å·¥ä½œæµå®Œæˆï¼"
          echo "ğŸ“Š å·²æäº¤ç½‘ç«™æ‰€æœ‰ URL åˆ°æœç´¢å¼•æ“"
          echo "â° ä¸‹æ¬¡è‡ªåŠ¨è¿è¡Œ: æ˜å¤© UTC 2:00"
